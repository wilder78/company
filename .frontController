<?php

    class frontController
    {
        private $action;
        private $params;

        // Function that generates a request process. --//-- Función que genera un proceso de solicitud.
        public function processRequest()
        {

            if (isset($_REQUEST["url"])) {

                $url = explode("/",trim($_REQUEST["url"]));
                $view = array_shift($url);
                if ($view == "api")
                {
                    define("CALL_API", true); // Me llama por API.
                }
                else
                {
                    define("CALL_API", false); //Me llamo por WEB.
                }
                $complement = $url;

                if (count($complement) == 0)
                    showError("Petición Invalida ", true);

                $this->action = array_shift($url);
                $this->params = $url;
                $result = $this->dispatcher($this->action, $this->params);
                
                if ($result["result"] == "fail")
                {
                    $result["view"] = "defaultError";
                }
                if (CALL_API)
                    print_r(json_encode($result));
                else    // Es un llamado para una interface WEB.
                        // Esta es la gran magia.
                        // llamo la clase que me renderiza la vista.
                    View::render($result);
            } else {
                print_r("Invalid Action :(...");
            }
        }


        public function dispatcher($action, $params)
        {
            $fileName = ACTIONS . $action . ".class.php";
            
            if (is_file($fileName)) {
                require_once $fileName;

                if (!class_exists($action)) {
                    echo "Clase no existe";
                } else {
                    $cmd = new $action();
                    return $cmd->execute($params);
                }
            } else 
                // die("Archivo no existe");
                showError("Archivo no existe", true);   
        }
    }

?>